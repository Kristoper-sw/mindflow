# 工作流实例管理功能说明

## 📋 功能概述

新增了完整的工作流实例（执行记录）管理功能，包括实例列表查看、详情查看、执行、终止和删除等操作。

## 🎯 新增页面

### 1. 工作流实例列表页面 (`/instances`)
**文件:** `src/views/WorkflowInstances.tsx`

#### 主要功能
- ✅ **查看所有执行记录** - 显示所有工作流实例及其状态
- ✅ **筛选功能** - 按工作流定义筛选实例
- ✅ **执行工作流** - 直接在列表页执行任意工作流
- ✅ **实时刷新** - 每5秒自动刷新，实时查看运行状态
- ✅ **终止执行** - 终止正在运行的工作流
- ✅ **删除记录** - 删除已完成/失败/终止的实例
- ✅ **查看详情** - 跳转到详情页查看完整执行信息

#### 界面元素
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回工作流列表              执行工作流 ►              │
│                                                         │
│  工作流执行记录                                          │
│                                                         │
│  ┌──────────────────────────────────────┐              │
│  │ 筛选工作流: [全部 ▼]  [刷新]          │              │
│  └──────────────────────────────────────┘              │
│                                                         │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 实例ID │ 工作流 │ 状态 │ 开始时间 │ 结束时间 │ 时长 ││
│  ├─────────────────────────────────────────────────────┤│
│  │   123  │ 测试流程│ 运行中│ 2024-... │    -    │ 5秒 ││
│  │   👁️ 🛑 ❌                                           ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

#### 状态标识
- 🔵 **运行中** (RUNNING) - 正在执行
- ⚪ **待执行** (PENDING) - 等待执行
- ✅ **已完成** (COMPLETED) - 成功完成
- ❌ **失败** (FAILED) - 执行失败
- ⚠️ **已终止** (TERMINATED) - 手动终止

### 2. 工作流实例详情页面 (`/instances/:id`)
**文件:** `src/views/WorkflowInstanceDetail.tsx`

#### 主要功能
- ✅ **实例概览** - 显示实例基本信息、状态、执行时间
- ✅ **输入/输出查看** - 折叠面板显示 JSON 格式的输入输出
- ✅ **节点执行详情** - 显示每个节点的执行状态和耗时
- ✅ **节点输入/输出** - 查看每个节点的输入输出数据
- ✅ **错误信息展示** - 高亮显示错误节点及错误信息
- ✅ **实时更新** - 运行中的实例每2秒自动刷新

#### 界面结构
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回执行记录                                          │
│                                                         │
│  工作流执行详情                                          │
│                                                         │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 实例概览                                            ││
│  │ ┌─────────────┬─────────────┐                     ││
│  │ │ 实例ID: 123 │ 开始时间    │                     ││
│  │ │ 工作流: XXX │ 结束时间    │                     ││
│  │ │ 状态: ✅    │ 执行时长    │                     ││
│  │ └─────────────┴─────────────┘                     ││
│  │                                                     ││
│  │ ▼ 输入参数                                          ││
│  │   { "key": "value" }                               ││
│  │                                                     ││
│  │ ▼ 输出结果                                          ││
│  │   { "result": "success" }                          ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 节点执行详情                                        ││
│  │ ┌───────────────────────────────────────────────┐  ││
│  │ │ 节点名称 │ 类型 │ 状态 │ 开始 │ 结束 │ 时长 │  ││
│  │ ├───────────────────────────────────────────────┤  ││
│  │ │ 开始节点 │START│  ✅  │ ... │ ... │ 1秒  │  ││
│  │ │   ▼ 节点输入                                   │  ││
│  │ │     { ... }                                   │  ││
│  │ │   ▼ 节点输出                                   │  ││
│  │ │     { ... }                                   │  ││
│  │ └───────────────────────────────────────────────┘  ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

## 🔗 路由配置

新增路由已添加到 `src/App.tsx`：

```typescript
// 工作流实例列表
<Route path="/instances" element={<PrivateRoute><WorkflowInstances /></PrivateRoute>} />

// 工作流实例详情
<Route path="/instances/:id" element={<PrivateRoute><WorkflowInstanceDetail /></PrivateRoute>} />
```

## 🌐 后端接口对接

### 已对接的接口
```typescript
// 获取所有实例
GET /api/workflows/instances

// 获取单个实例详情（含节点信息）
GET /api/workflows/instances/{id}

// 创建/执行工作流实例
POST /api/workflows/instances?workflowDefinitionId={id}&input={json}

// 终止运行中的实例
POST /api/workflows/instances/{id}/terminate

// 删除实例
DELETE /api/workflows/instances/{id}
```

## 📊 数据流

```
用户操作 → WorkflowInstances 组件
         ↓
    API 调用 (workflow.ts)
         ↓
    Axios 请求 (axios.ts)
         ↓
    后端 API (/api/workflows/instances)
         ↓
    数据返回 ← 响应处理
         ↓
    状态更新 → UI 刷新
```

## 🎨 UI 特性

### 1. 实时状态更新
- 列表页：每5秒自动刷新
- 详情页：每2秒自动刷新（仅运行中的实例）

### 2. 状态徽章
- 使用 Material-UI Chip 组件
- 不同状态对应不同颜色和图标
- 直观显示执行状态

### 3. 折叠面板
- 使用 Accordion 组件
- 优雅展示大段 JSON 数据
- 节省屏幕空间

### 4. 响应式布局
- Grid 布局自动适配
- 移动端友好

### 5. 用户交互优化
- 确认对话框（删除操作）
- 消息提示（操作反馈）
- 加载状态显示
- 错误提示高亮

## 🔄 页面跳转流程

```
工作流列表 (/workflows)
    │
    ├─ 点击"执行记录" → 工作流实例列表 (/instances?workflowId=123)
    │                      │
    │                      ├─ 点击"查看详情" → 实例详情 (/instances/456)
    │                      │                      │
    │                      │                      └─ 返回 → 实例列表
    │                      │
    │                      └─ 返回 → 工作流列表
    │
    └─ 全局导航 → 实例列表 (/instances)
```

## 🚀 使用示例

### 执行工作流
1. 进入工作流列表页 (`/workflows`)
2. 点击某个工作流的"执行记录"图标，或点击右上角"执行工作流"按钮
3. 在弹出对话框中选择工作流
4. 输入 JSON 格式的参数（可选）
5. 点击"执行"

### 查看执行详情
1. 进入实例列表页 (`/instances`)
2. 点击某条记录的"查看详情"图标
3. 查看实例概览、输入输出、节点执行详情

### 终止运行中的工作流
1. 在实例列表中找到状态为"运行中"的实例
2. 点击"终止"图标
3. 工作流将被标记为"已终止"

### 删除执行记录
1. 在实例列表中找到已完成/失败/终止的实例
2. 点击"删除"图标
3. 确认删除操作

## 🐛 注意事项

### 后端要求
1. **删除工作流定义接口** - 需要确保后端已实现 `DELETE /api/workflows/definitions/{id}`
2. **实例关联检查** - 后端应检查是否有关联实例，避免误删
3. **状态流转** - 确保状态值匹配：`PENDING`, `RUNNING`, `COMPLETED`, `FAILED`, `TERMINATED`

### 数据格式
- 输入输出必须是合法的 JSON 字符串
- 时间格式应为 ISO 8601 格式

### 安全性
- 所有页面都受 JWT 认证保护
- 只能删除非运行状态的实例

## 📝 TODO（可选扩展）

- [ ] 添加实例搜索功能
- [ ] 添加日期范围筛选
- [ ] 支持批量删除
- [ ] 添加实例导出功能（JSON/CSV）
- [ ] WebSocket 实时推送（替代轮询）
- [ ] 添加节点执行可视化（流程图高亮）
- [ ] 支持重新执行失败的工作流

## 🎉 完成状态

✅ 工作流实例列表页面  
✅ 工作流实例详情页面  
✅ 执行工作流功能  
✅ 终止工作流功能  
✅ 删除实例功能  
✅ 实时状态更新  
✅ 路由配置  
✅ 类型定义  
✅ API 对接  

所有功能已完成并可立即使用！🚀

